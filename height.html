<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PoseNet Height Estimator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
  <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js" type="text/javascript"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: #0f0f0f;
      color: #f0f0f0;
      font-family: sans-serif;
      height: 100vh;
      margin: 0;
    }
    canvas {
      border: 2px solid #f0f0f0;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>PoseNet Height Estimator</h1>
  <p id="heightDisplay">Loading PoseNet...</p>

  <script>
    let video;
    let poseNet;
    let pose;

    function setup() {
      createCanvas(640, 480);
      video = createCapture(VIDEO);
      video.size(width, height);
      video.hide();

      poseNet = ml5.poseNet(video, modelLoaded);
      poseNet.on("pose", gotPoses);
    }

    function modelLoaded() {
      console.log("PoseNet ready");
      document.getElementById("heightDisplay").innerText = "PoseNet ready â€“ stand in view";
    }

    function gotPoses(poses) {
      if (poses.length > 0) {
        pose = poses[0].pose;
      }
    }

    function draw() {
      image(video, 0, 0);

      if (pose) {
        // Get keypoint positions
        const headY = pose.keypoints[0].position.y; // nose (approx top)
        const leftAnkleY = pose.keypoints[15].position.y;
        const rightAnkleY = pose.keypoints[16].position.y;
        const avgAnkleY = (leftAnkleY + rightAnkleY) / 2;
        const pixelHeight = avgAnkleY - headY;

        // Example: assume ~0.5 cm per pixel (adjust this based on calibration)
        const scaleFactor = 0.5;
        const estimatedHeight = pixelHeight * scaleFactor;

        // Draw keypoints
        for (let kp of pose.keypoints) {
          if (kp.score > 0.2) {
            fill(255, 0, 0);
            noStroke();
            ellipse(kp.position.x, kp.position.y, 8, 8);
          }
        }

        // Display height
        fill(255);
        textSize(18);
        text(`Estimated height: ${estimatedHeight.toFixed(1)} cm`, 10, 20);
        document.getElementById("heightDisplay").innerText =
          `Estimated height: ${estimatedHeight.toFixed(1)} cm`;
      }
    }
  </script>
</body>
</html>
